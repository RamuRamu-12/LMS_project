#!/usr/bin/env node

/**
 * Production Environment Setup Script
 * 
 * This script helps you set up the correct environment variables for production deployment.
 * Run this script before building the frontend for production.
 */

const fs = require('fs');
const path = require('path');
const readline = require('readline');

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

console.log('ðŸš€ LMS Frontend Production Environment Setup');
console.log('=============================================\n');

console.log('This script will help you configure the backend API URL for production deployment.\n');

console.log('Common backend deployment patterns:');
console.log('1. AWS Elastic Beanstalk: https://your-app.region.elasticbeanstalk.com');
console.log('2. AWS EC2: http://your-ec2-ip:5000');
console.log('3. AWS API Gateway: https://your-api-id.execute-api.region.amazonaws.com/prod');
console.log('4. Heroku: https://your-app.herokuapp.com');
console.log('5. Railway: https://your-app.railway.app');
console.log('6. Render: https://your-app.onrender.com');
console.log('7. Vercel: https://your-app.vercel.app');
console.log('8. Netlify Functions: https://your-app.netlify.app');
console.log('');

rl.question('Enter your backend API URL (without /api suffix): ', (backendUrl) => {
  if (!backendUrl) {
    console.log('âŒ No URL provided. Exiting...');
    rl.close();
    return;
  }

  // Clean up the URL
  let cleanUrl = backendUrl.trim();
  if (cleanUrl.endsWith('/')) {
    cleanUrl = cleanUrl.slice(0, -1);
  }
  if (cleanUrl.endsWith('/api')) {
    cleanUrl = cleanUrl.slice(0, -4);
  }

  // Create .env.production file
  const envContent = `# Production Environment Variables
# Generated by setup-production-env.js
VITE_API_URL=${cleanUrl}
VITE_GOOGLE_CLIENT_ID=your_google_client_id_here
`;

  const envPath = path.join(__dirname, '.env.production');
  
  try {
    fs.writeFileSync(envPath, envContent);
    console.log(`âœ… Created .env.production file with API URL: ${cleanUrl}`);
    console.log('');
    console.log('Next steps:');
    console.log('1. Update VITE_GOOGLE_CLIENT_ID with your actual Google OAuth client ID');
    console.log('2. Run: npm run build');
    console.log('3. Deploy the dist/ folder to your hosting service');
    console.log('');
    console.log('The frontend will now make API requests to:', `${cleanUrl}/api`);
  } catch (error) {
    console.error('âŒ Error creating .env.production file:', error.message);
  }

  rl.close();
});

rl.on('close', () => {
  console.log('\nSetup complete! ðŸŽ‰');
  process.exit(0);
});
